#!/usr/bin/env bash
# Copyright (c) 2011 Concurrent, Inc.

if [[ "$MT_PATH" == "" ]]; then
  MT_PATH=`dirname $(cd ${0%/*}/.. && echo $PWD/${0##*/})`
fi

function include_dependencies () {
  if [[ $# -gt 0 ]]; then
    for dep in "$@"; do
      . $MT_PATH/bin/functions/$dep.inc
    done
  fi
}

include_dependencies jar install

mt_install_set_destination

while [[ $# -gt 0 ]]; do
  case "$1" in
    -h|--help)
      mt_install_usage
      exit 0
      ;;
    --destination=*)
      mt_install_destination=${1/--destination=/}
      ;;
    -d|--destination)
      if [[ -n "${2:-}" ]] ; then
        mt_install_destination="$2"
        shift
      else
        echo "$1 must be followed by a destination."
        exit 1
      fi
      ;;
    -u|--uninstall)
      mt_install_remove_existing
      exit 0
      ;;
    *)
      echo "Invalid flag or option: $1"
      mt_install_usage
      exit 1
      ;;
  esac
  shift
done

mt_install_remove_existing
mt_install_all_files
