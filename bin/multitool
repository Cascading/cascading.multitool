#!/usr/bin/env bash
# Copyright (c) 2011 Concurrent, Inc.

if [ -z "$MT_PATH" ]
then
  if [ -h $0 ]
  then
    MT_PATH=`dirname $0`/`readlink $0`
  else
    MT_PATH=$0
  fi

  MT_PATH=`dirname $MT_PATH`/..
  MT_PATH=`cd $MT_PATH && pwd`
fi

MODULES_ROOT=$MT_PATH/bin/functions
. $MT_PATH/bin/functions/_module.inc

module_depends run install uninstall help parameters version

extract_opts()
{
  while [ $# -gt 0 ];
  do
    case "$1" in
      -q|--quiet)
        mt_log_verbose=
        ;;
      -nc|--no-color|--no-colour)
        mt_log_use_color=
        ;;
      *)
        extracted_opts="$extracted_opts$1 "
        ;;
    esac
    shift
  done
}

dispatch ()
{
  module=$1
  shift
  
  case "$module" in
    version|-v|--version)
      mt_version $@
      ;;
    help|-h|--help)
      mt_help $@
      ;;
    install)
      mt_install $@
      ;;
    uninstall)
      mt_uninstall $@
      ;;
    *)
      mt_run $module $@
      ;;
  esac
}

extract_opts $@
dispatch $extracted_opts
