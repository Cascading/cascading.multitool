import java.text.SimpleDateFormat

apply plugin:'java' 
apply plugin: 'idea'
apply plugin: 'eclipse'

def timestamp = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(
                                             new Date())

repositories{
    mavenLocal()
    mavenCentral()
    mavenRepo name: 'conjars', url: 'http://conjars.org/repo/'
}

dependencies{
    compile 'cascading:cascading-core:2.2.+'
    compile 'cascading:cascading-hadoop:2.2.+'
    compile 'org.apache.hadoop:hadoop-core:1.0.4'
    compile 'org.slf4j:slf4j-log4j12:1.7.5'

    testCompile 'junit:junit:4.11'
    testCompile 'org.slf4j:slf4j-log4j12:1.7.5'
    testCompile 'cascading:cascading-core:2.2.+:tests'
    testCompile 'org.apache.hadoop:hadoop-test:1.0.4'

}


jar {
  description = "Assembles a Hadoop ready jar file"
  doFirst {
    into('lib') {
      from configurations.compile
    }
  }

  manifest {
    attributes "Main-Class": "${archivesBaseName}/Main",
               'Build-Time': "${timestamp}"
  }
}


task mtTest() << { task ->
    Process proc = 
   ["/bin/sh", "src/test/mt/helper/roundup.sh", 
      "src/test/mt/*.sh"].execute()
    proc.consumeProcessErrorStream(System.err)
    proc.consumeProcessOutputStream(System.out)
    if (proc.waitFor() != 0) {
        throw new RuntimeException('exec failed')
    }
} 
